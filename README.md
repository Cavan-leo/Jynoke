# Jynoke - 个人工具集合

Jynoke 是一个使用 React 18 和 TensorFlow.js 构建的个人工具集合项目。它包含两个核心组件：重量价格转换器和手势识别骰子滚轮。

## 功能特性

### 重量价格转换器 (WeightPriceConverter)
- 输入重量（克）和总价（元）
- 自动计算单位重量价格（每 500g/斤）
- 实时输入验证和错误提示
- 支持清除功能重置所有字段

### 骰子滚轮 (DiceRoller)
- 点击骰子进行滚轮
- 手势识别功能：通过摄像头检测手部快速挥动来触发滚轮
- 平滑的动画效果（0.5 秒旋转 + 浮动动画）
- 动画锁定防止并发滚轮
- 实时摄像头馈送显示

## 应用架构

应用采用**标签页导航**设计：
- 顶部导航栏显示两个工具的选项卡
- 点击选项卡切换不同的工具
- 每个工具单独显示，不会相互干扰
- 平滑的淡入淡出动画效果

## 技术栈

- **React 18** - UI 框架
- **TypeScript** - 类型安全
- **Tailwind CSS** - 样式框架
- **TensorFlow.js** - 机器学习
- **@tensorflow-models/hand-pose-detection** - 手势识别
- **Vitest** - 单元测试框架
- **fast-check** - 基于属性的测试

## 安装和设置

### 前置要求
- Node.js 16+ 
- npm 或 yarn

### 安装依赖

```bash
npm install
```

### 开发服务器

```bash
npm run dev
```

应用将在 `http://localhost:5173` 启动

### 构建生产版本

```bash
npm run build
```

### 运行测试

```bash
# 运行所有测试（单次运行）
npm run test:run

# 运行测试（监视模式）
npm run test
```

## 项目结构

```
src/
├── components/
│   ├── WeightPriceConverter.tsx    # 重量价格转换器组件
│   ├── DiceRoller.tsx              # 骰子滚轮组件
│   ├── ErrorBoundary.tsx           # 错误边界组件
│   └── index.ts                    # 组件导出
├── utils/
│   ├── validation.ts               # 输入验证和价格计算
│   ├── camera.ts                   # 摄像头管理
│   ├── gestureDetection.ts         # 手势检测逻辑
│   └── animation.ts                # 动画工具
├── types/
│   └── index.ts                    # TypeScript 类型定义
├── App.tsx                         # 主应用容器
├── main.tsx                        # 应用入口
└── index.css                       # 全局样式
```

## 核心功能说明

### 价格计算公式

```
单位价格 = (总价 / 重量) * 500
```

例如：
- 重量：500g，总价：100 元
- 单位价格 = (100 / 500) * 500 = 100 元/斤

### 手势识别

手势识别使用 TensorFlow.js 的 MediaPipe Hands 模型：
- 检测 21 个手部关键点
- 计算手掌中心位置
- 检测快速挥动（超过 50px 的移动）
- 防抖处理（500ms 内不重复触发）
- 异步手势检测循环，不阻塞 UI

### 动画系统

骰子滚轮动画特性：
- 0.5 秒内完成 360° 旋转
- 结合垂直浮动效果
- 动画期间防止重复触发
- 动画完成后显示随机结果

## 测试

项目包含全面的测试套件：

### 单元测试
- 价格计算准确性
- 输入验证
- 清除功能
- 骰子值范围

### 基于属性的测试
- 使用 fast-check 库
- 验证通用属性
- 100+ 次迭代
- 覆盖边界情况

### 运行测试

```bash
# 单次运行所有测试
npm run test:run

# 监视模式（开发时使用）
npm run test

# 运行特定测试文件
npm run test:run -- src/components/DiceRoller.test.ts
```

## 错误处理

应用包含全面的错误处理：

### WeightPriceConverter 错误
- 空输入检查
- 非数字输入验证
- 负数检查
- 零值检查
- 超大数字检查

### DiceRoller 错误
- 摄像头权限拒绝
- 摄像头不可用
- 手势识别模型加载失败
- 浏览器不支持摄像头

所有错误都显示友好的中文错误消息。

## 响应式设计

应用支持多种设备：

### 移动设备 (375px)
- 输入字段：100% 宽度
- 骰子大小：60px
- 摄像头馈送：最大 400px

### 桌面设备 (1920px)
- 输入字段：最大 400px
- 骰子大小：80px
- 摄像头馈送：最大 400px

## 浏览器兼容性

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- 需要支持 WebRTC 和 WebGL

## 性能优化

- 手势检测以 30fps 运行
- 防抖处理防止过度计算
- 动画使用 CSS 关键帧
- 模型加载异步处理
- 资源清理防止内存泄漏

## 许可证

MIT

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题或建议，请提交 Issue。


## 最近改进

### v1.1 更新
- ✅ 实现标签页导航，工具单独显示
- ✅ 修复摄像头手势检测循环
- ✅ 改进状态管理，防止内存泄漏
- ✅ 优化手势检测性能

### 已知限制
- 手势识别在低光环境下效果较差
- 需要较好的网络连接来加载 MediaPipe 模型
- 某些浏览器可能不支持 WebRTC

## 故障排除

### 摄像头不工作
1. 检查浏览器是否支持 WebRTC
2. 确认已授予摄像头权限
3. 检查网络连接（需要加载 MediaPipe 模型）
4. 尝试刷新页面

### 手势识别不响应
1. 确保摄像头有足够的光线
2. 手部应该完全在摄像头视野内
3. 快速挥动手部（超过 50px 的移动）
4. 等待 500ms 后再次尝试（防抖机制）

### 性能问题
1. 关闭其他标签页以释放资源
2. 降低浏览器分辨率
3. 禁用摄像头功能以减少 CPU 使用
